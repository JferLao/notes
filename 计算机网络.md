# 计算机网络 

### OSI七层模型
1. 应用层:为计算机用户提供接口和服务
2. 表示层:数据处理
3. 会话层:管理通信会话
4. 传输层:管理端到端的通信连接
5. 网络层:数据路由
6. 数据链路层:管理相邻节点之间的数据通信
7. 物理层:数据通信的光电模型

### TCP/IP四层结构
1. 应用层:应用层+会话层+表示层    HTTP/FTP
2. 传输层       TCP/UDP
3. 网络层       IP/ICMP
4. 网络接口层:数据链路层+物理层     ARP/RARP/Ethernet


### 计算机网络的性能指标
1. 速率(Mbps)
2. 时延
    + 发送时延=数据长度(bit)/发送速率(bit/s)
    + 传播时延=传播路径距离/传播速率(bit/s)
    + 排队时延:数据包在网络设备中等待被处理的时间
    + 处理时延:数据包到达设备或目的机器被处理所需要的时间
3. 往返时间(RTT):数据报文在端到端通信中的来回一次的时间(使用ping查看)


## 物理层
> 作用:连接不同的物理设备,传输比特流
+ 信道:信道是往一个方向传送信息的媒体
+ 一条通信电路包含一个接收信道和一个发送信道
+ 信道分为:单工通信信道（只能一个方向通信）、半双工通信信道（双方都可以发送和接收，双方不能同时发送或接收）、全双工通信信道（双方都可以发送和接收）
+ 分用-复用技术：通过共享复用信道和分用信道来共用一条信道和接收和发送通信


## 数据链路层
> 作用:封装成帧、透明传输、差错监测
+ 帧是数据链路层数据的基本单位
+ MTU：最大传输单元，描述数据链路层的数据帧的最大值，数据帧不能大于MTU
+ 数据帧过大或过小都会影响传输的效率

#### 以太网协议
> MAC地址:每个设备都拥有唯一的Mac地址(看做id),共48位.
+ 以太网是一种使用广泛的局域网技术,是一种应用于数据链路层的协议,使用以太网可以完成相邻设备的数据帧传输
+ 格式:目的地址-源地址-类型-帧数据-CRC
+ MAC地址表可以将mac地址映射到硬件接口
**通信方法**
1. A通过网卡发出数据帧
2. 数据帧到达路由器,路由器取出前6字节
3. 路由器匹配MAC地址表,找到对应的网络接口
4. 路由器往该网络接口发送数据帧
5. 加入检查MAC地址表时会将广播A的包发送到除A之外的设备,找到设备后再记录


## 网络层
#### IP协议
> 虚拟互联网络:实际的计算机网络错综复杂,物理设备通过使用IP协议,屏蔽了物理网络之间的差异,所以主机使用IP协议连接时则无需关注网络细节
+ IP协议使得复杂的实际网络变成一个虚拟互联的网络
+ IP协议使得网络层可以屏蔽底层细节而专注网络层的数据转发
+ IP协议解决了在虚拟网络中数据报传输路径的问题
+ IP地址长度为32位,常分成4个8位.也常适应点分十进制来表示

### IP协议的转发流程
1. A发出目的地IP数据报,查询路由表发现下一条B
2. A将数据报发送给B
3. B查询路由表发现下一条为C,将数据报发送给C
4. C查询路由表发现目的地D直接连接,将数据报发送给D

+ 数据帧的每一条的Mac地址都在变化
+ IP数据报每一跳的IP地址始终不变

#### ARP协议
>ARP(Address Resoluction Protrol)地址解析协议:将网络层IP32位地址转变为数据链路层MAC48位地址
+ ARP缓存表缓根据是否存有IP地址和MAC地址的映射关系来进行不同操作
+ ARP缓存表中的记录并不是永久有效的,有一定的期限,会随着IP地址的变化而变化

#### RARP
>RARP(Reverse Address Resoluction Protrol)逆地址解析协议:将数据链路层MAC48位地址解析为网络层IP32位地址
+ (R)ARP协议是TCP/IP协议栈里面基础的协议,并且其操作对程序员是透明的,无需操作的

### IP地址的子网划分
**分类的IP地址**
1. A类地址:8位网络号+24位主机号(前8位前面两位为01)
2. B类地址:16位网络号+16位主机号(前8位前面两位为10)
3. C类地址:24位网络号+8位主机号(前8位前面两位为11)
**特殊主机号**
+ 主机号全0表示当前网络段,不可分配为特定主机
+ 主机号为全1表示广播地址

**特殊网络号**
+ A类地址:0特殊网络
+ A类地址:127回环地址
+ B类地址:128不可使用
+ C类地址:192.0.0不可使用
> 回环地址:本地虚拟接口,一般用来ping这个地址来检查本地网络协议,基本数据接口是否正常等

### 网络地址转换NAT技术
+ 内网地址:内部机构使用,避免与外网地址重复
+ 外网地址:全球范围使用,全球公网唯一
> NAT(Network Address Translation)技术用于多个主机通过一个公有IP访问互联网的私有网络中,使得内网设备请求到外网设备


### 内部网关路由协议
#### OSPF(Open Shortest path First)开放最短路径优先
> 核心:dijkastra算法
+ 向所有的路由器发送消息=>获得网络中的搜有信息=>得到网络的完整拓扑=>通过算法获得最短路径
**五种消息类型**
1. 问候消息
2. 链路状态数据库描述信息
3. 链路状态请求信息
4. 链路状态更新消息
5. 链路状态确认消息
**过程**
+ 路由器接入网络=>路由器向邻居发出问候消息=>与邻居交流链路状态数据库=>广播和更新位置路由



#### 链路状态(LS)协议 
+ 向所有路由器发送消息
+ 消息(距离/时延/带宽等,可以由网络管理人员决定的)描述路由器与相邻的链路状态
+ 只有链路状态发生变化时,才发送更新信息


## 传输层

#### UDP(User Datagran Protocol)用户数据报协议
+ 数据报是应用层传输过来完整的数据
+ UDP是无连接协议:不需要建立连接来传输数据
+ UDP不能保证可靠的交付数据
+ UDP是面向报文传输的:不会对报文进行处理,而是直接发送
+ UDP没有拥塞控制:不管网络拥塞情况都会将数据发送出去
+ UDP的首部开销很小

#### TCP(Transmission Control Protocol)传输控制协议
+ TCP是面向连接的协议:需要建立连接
+ TCP的一个连接有两端(点到点的通信)
+ TCP提供可靠的传输服务
+ TCP协议提供全双工的通信
+ TCP是面向字节流的协议:面向流出进程的字节数列,对字节进行处理

**TCP标记**
1. URG:紧急数据
2. ACK:确认位(ACK=1表示确认消息生效)
3. PSH:推送位(PSH=1表示尽快把数据交付给应用层)
4. RST:重置位(RST=1表示重新建立连接)
5. SYN:同步位(SYN=1表示连接请求报文)
6. FIN:终止位(FIN=1表示释放连接)

### TCP协议的可靠传输
+ TCP的可靠传输基于连续ARQ协议
+ TCP的滑动窗口以字节为单位

### TCP连接的建立(三次握手)
1. 发送方发送报文(SYN=1,seq=x)
2. 接收方发送报文(SYN=1,ACK=1,seq=y,ack=x+1)
3. 发送方发送报文(ACK=1,seq=x+1,ack=y+1)
+ 监听:第一次发送方发送报文时
+ 同步已发送:第一次发送方发送报文时和接收方发送报文的过程
+ 同步已接收:接收方发送报文和第二次发送方发送报文时过程
+ 建立连接:发送方=接收方发送报文之后;接收方=接收方收到第二次发送方发送报文
> 为什么需要第三次发送报文:已经失效的连接请求报文传送回到对方,引起错误

### TCP连接的释放(四次握手)
1. 发送方发送报文(FIN=1,seq=u)
2. 接收方发送报文(ACK=1,seq=v,ack=u+1)
3. 接收方再次发送报文(FIN=1,ACK=1,seq=w,ack=u+1)
4. 发送方发送报文:(ACK=1,seq=u+1,ack=w+1)

### 套接字与套接字编程
> 使用端口来标记不同的网络进程,端口使用16比特位来表示
+ 套接字(socket)表示TCP连接的一端,通过套接字可以进行数据发送或接收


## 应用层
#### DNS(Domain Name System)域名系统
> 通过IP地址合服务找到对应主机的进程
+ 输入域名然后通过DNS服务转成对应IP地址再访问对应服务

#### DHCP(Dynamic Host Configuration Protocol)动态主机设置协议
+ 局域网协议
+ 是应用UDP协议的应用层协议
+ 即插即用联网
+ 应用:一般网络连接时的自动获得IP地址

#### HTTP(HyperText Transfer Protocol)超文本传输协议
> http(s)://<主机>:<端口>/<路径>
+ HTTP协议是可靠的数据传输协议

#### HTTPS(secure)
> http(s)://<主机>:<端口>/<路径>
+ 对称加密:使用秘钥加密和使用秘钥解密
+ 数字证书是可信任组织办法给特定对象的认证

#### SSL(Secure Sockets Layer)安全套接层
> 位于应用层和传输层之间
+ 保障数据安全和数据完整
+ 对传输层数据进行加密后传输

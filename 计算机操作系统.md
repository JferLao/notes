# 操作系统

### 操作系统的演进
1. 无操作系统
    + 人工操作
    + 用户独占
    + CPU等待人工处理
    + 资源利用率很低
2. 批处理系统
    + 无需等待人工操作
    + 批量输入任务
    + 资源利用率提升
    + 多道程序设计
3. 分时系统
    + 人机交互
    + 多用户共享
    + 及时调试程序


### 操作系统概率
1. 操作系统是管理计算机硬件和软件资源的计算机程序
2. 通过管理配置内存、决定资源供需顺序、控制输入输出设备等
3. 操作系统提供用户操作界面

### 操作系统相关概念
1. 并行和并发
    + 并行是指两个或多个事件可以在同一时刻发生
    + 并发是指两个或多个事件可以在同一个时间间隔发生
2. 共享性
    + 共享性表现为操作系统中的资源可供多个并发的程序共同使用
    + 共同使用的形式称之为资源共享
    + 资源共享根据属性可分为两种方式:互斥共享形式和同时访问形式
3. 虚拟性
    + 虚拟性表现为把一个物理实体转变为若干个逻辑实体
    + 物理实体是真实存在的,逻辑实体是虚拟的
    + 虚拟的技术主要有时分复用技术和空分复用技术
4. 异步性
    + 在多道程序环境下,允许多个进程并发执行
    + 进程在使用资源时可能需要等待或放弃
    + 进程的执行并不是一气呵成的,而是走走停停的形式
    + 进程以不可预知的速度向前推进,不知道何时执行/暂停/完成

## 进程管理
1. 进程是系统进行资源分配和调度的基本单位
2. 进程作为程序独立运行的载体和保障程序正常执行
3. 进程的存在使得操作系统资源的利用率大幅度提升

### 进程实体
**主存中的进程形态**
1. 状态：标记进程的进程状态
2. 优先级：
3. 程序计数器：指向即将进行的下一跳指令的地址
4. 内存指针：程序代码、进程数据相关指针
5. 上下文数据：进程执行时处理器存储的数据
6. IO状态信息：记录被进程IO操作所占用的文件列表
7. 记账信息：记录使用处理器时间、时钟数总和等
8. 标识符：唯一标的一个进程，用于区别进程

**进程控制块（PCB）**
1. 用于描述和控制进程运行的通用数据结构
2. 记录进程当前状态和控制进程运行的全部信息
3. PCB使得进程是能够独立运行的基本单位
+ PCB常驻内存，有独立区域存储PCB


**进程和线程**
1. 线程是操作系统进行运行调度的最小单位
2. 进程是系统进行资源分配和调度的基本单位
3. 一个进程可以并发多个线程,每个线程执行不同的任务
4. 进程里的线程共享进程资源,线程不拥有独立的资源

### 五状态模型
> 五个状态:创建、就绪、终止、阻塞、执行

**就绪状态**
1. 当进程被分配到除CPU以外所有必要资源后
2. 其他资源都准备好,之差CPU资源的状态就位就绪状态
3. 在一个系统中多个处于就绪状态的进程通常排成一个队列称为就绪队列

**执行状态**
1. 进程获得CPU,其程序正在执行被称为执行状态
2. 在单机处理中,在某一个时刻只能有一个进程是处于执行状态

**阻塞状态**
1. 进程因某种原因无法执行从而放弃CPU的状态称为阻塞状态
2. 阻塞队列:存放一个或多个阻塞的进程

**创建状态**
1. 创建进程时拥有PCB但其他资源尚未就绪的状态称为创建状态

**终止状态**
1. 进程结束有系统清理或归还PCB的状态称为终止状态


### 进程同步
**根源需求**
1. 解决对竞争资源在多进程间进行使用次序的协调
2. 解决使得并发执行的多个进程之间可以有效使用资源和相互合作

**原则**
1. 空闲让进:资源无占用允许使用
2. 忙则等待:资源有占用,请求进程等待
3. 有限等待:保证单有限等待时间能够使用资源
4. 让权等待:等待时,进程需要让出CPU

## 作业管理
### 进程调度
> 进程调度是指计算机通过决策决定那个就绪的进程可以获得CPU使用权
1. 保留旧进程的运行信息,清除旧进程
2. 选择新进程,准备运行环境并分配CPU

**机制**
1. 就绪队列的排队机制
    + 将就绪进程按照一定的方式排成队列,一遍调度程序可以最快找到就绪进程
2. 选择运行进程的委派机制
    + 以一定的策略选择进程
3. 新老进程的上下文切换机制
    + 保存当前进程的上下文信息,装入被委派执行进程的运行上下文

**抢占**
> 旧进程未完成时
1. 非抢占式的调度
    + 系统开销:切换次数少,开销小
    + 不公平
    + 应用:专用系统
2. 抢占式的调度
    + 频繁切换,开销大
    + 相对公平
    + 通用系统

### 进程调度的算法
1. 先来先服务调度算法
2. 短进程优先调度算法
    + 不利于长作业进程的执行
3. 高优先权优先调度算法
4. 时间片轮转调度算啊

### 死锁
> 死锁是指两个或两个以上的线程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程。

**死锁的产生**
1. 竞争资源
    + 共享资源数量有限
    + 等待请求的资源被释放/自身资源不释放
2. 进程调度顺序不当


**四个必要条件**
1. 互斥条件
    + 进程对资源的使用是排他性使用
2. 请求保持条件
    + 进程至少保持一个资源,又提出新的资源请求
3. 不可剥夺条件
    + 进程获得资源在未完成前不能被剥夺
4. 环路等待条件
    + 发生死锁时,必然存在进程-资源环形链


**死锁的处理**
1. 预防死锁的方法
    + 破坏死锁产生的四个必要条件中一个或多个即可
2. 银行家算法


## 存储管理
### 内存分配与回收

**内存分配的过程**
1. 单一连续分配
2. 固定分区分配
    + 内存空间划分为若干固定大小的区域
    + 每个分区只提供给一个进程使用,互不干扰
3. 动态分区分配
    + 动态分区空闲表数据结构
    + 动态分区空闲链数据结构
    + 动态分区分配算法
        + 首次适应算法
        + 最佳适应算法
        + 快速适应算法

### 页式存储管理
1. 页式存储管理
    + 页表记录进程逻辑空间和物理空间的映射
    + 地址:页号和页内偏移
2. 段式存储管理
    + 将进程逻辑空间划分为若干段
    + 段的长度由连续逻辑的长度决定
    + 段表:段号-基址-段长
3. 段页式存储管理
    + 先将逻辑空间按段式管理分成若干段
    + 再把段内空间按页式管理等分成若干页


### 虚拟内存
**概述**
1. 把程序使用内存划分,将部分暂时不用的内存放置在辅存

**程序的局部性原理**
> 是指程序在执行时呈现出局部性规律,即在一段时间内,整个程序的执行仅限于程序中的某一部分。相应地,执行所访问的存储空间也局限于某个内存区域。 

**虚拟内存的置换算法**
1. 先进先出算法(FIFO)
2. 最不经常使用算法(LFU)
3. 最近最少使用算法(LRU)
> 替换策略发生在CACHE主存层次/主存-辅存层次

## 文件管理
### 逻辑结构
1. 无结构文件(流式文件):以字节为单位
2. 顺序文件:按顺序存放在存储介质中
3. 索引文件:解决可变长文件存储而发明的一种文件格式
4. 有结构文件

### 辅存的存储空间分配
1. 连续分配
2. 链接分配
3. 索引分配

### 辅存的分配方式
1. 空闲表
2. 空闲链表
3. 位示图

### 目录树
> 任何文件或目录只有唯一路径


## 设备管理
### 广义的IO设备
> 对CPU而已,凡是对CPU进行数据输入的都是输入设备,凡是CPU进行数据输出的都是输出设备

### IO设备的缓冲区
> CPU与IO设备IDE速率不匹配
+ 减少CPU处理IO请求的频率
+ 提高CPU与IO设备之间的并行性
